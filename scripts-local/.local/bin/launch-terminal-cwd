#!/bin/bash
# Launch terminal in the current working directory of the active terminal
# Falls back to $HOME if unable to determine CWD

get_terminal_cwd() {
  # Get PID of active window
  terminal_pid=$(hyprctl activewindow -j | jq -r '.pid' 2>/dev/null)

  if [[ -n $terminal_pid ]]; then
    # Get shell child process of terminal
    shell_pid=$(pgrep -P "$terminal_pid" | tail -n1)

    if [[ -n $shell_pid ]]; then
      # Read cwd symlink
      cwd=$(readlink -f "/proc/$shell_pid/cwd" 2>/dev/null)

      if [[ -d $cwd ]]; then
        echo "$cwd"
        return
      fi
    fi
  fi

  # Fallback to home
  echo "$HOME"
}

cwd=$(get_terminal_cwd)
alacritty --working-directory "$cwd" &
